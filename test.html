

<!DOCTYPE html>

<html>

<head>
<title>Урмас Репинский - Тестовое Задание</title> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="google-site-verification" content="v6u7i24jgVhRRKYDwtq6zl5T86g4v9C7nzJ_UYw1LiU" />

<link rel="stylesheet" href="styles.css" type="text/css">



</head>

<body style="background: url('images/icons/background/brick_wall.jpg');  background-size: cover; background-attachment: fixed;" >

<!-- Header Image Table -->
<table cellspacing="0" cellpadding="0" width="1000" align="center" border="0">
        <tr> 
                <td  height="3"></td>
        </tr>   
        <tr>
                <td width="1000">
                        <img src="images/icons/urmas.jpg" alt="Я" title="Я"  width="1000" style="display: block">
                </td>
        </tr>


</table>




<!-- Main Table -->
<table cellspacing="0" cellpadding="0" border="0"  width="1000px" align="center">
        <tr> 

		<td width="827" valign="top" align="center" bgcolor="#d0e7f7" height="100%"> <!-- Functional Table -->


<table cellspacing="0" cellpadding="0" width="100%" border="0" bgcolor="#d0e7f7">
<!-- Table where search, name and languages and func area-->
<tr><td>


<table cellspacing="0" cellpadding="0" width="100%" border="0" bgcolor="#d0e7f7">
<!-- Table with search, name and languages -->
        <tr> 
                <td  class="title_blue" style="width: 530px;"><a name="welcome">Урмас Репинский - Тестовое Задание - ООО Лаборатория системных технологий</a></td>
        </tr>

        <tr>
                <td height="3" bgcolor="#ff8a00"></td>
        </tr>   

</table>


<table cellspacing="2" cellpadding="0" width="100%">

        <tr align="center">
			<td width="250px" valign="top" style = "border: #84bde4 1px solid;  background-color: #d0e7f7">
				<table id="menuTable">
					<tr><td>	<a href="javascript:algoritm()">Алгоритм</a></td></tr>
					<tr><td>	<a href="javascript:test(1)">Тест 1</a></td></tr>
					<tr><td>	<a href="javascript:test(2)">Тест 2</a></td></tr>
					<tr><td>	<a href="javascript:test(3)">Тест 3</a></td></tr>
					<tr><td>	<a href="javascript:test(4)">Тест 4</a></td></tr>
					<tr><td>	<a href="javascript:test(5)">Тест 5</a></td></tr>
					<tr><td>	<a href="javascript:test(6)">Тест 6</a></td></tr>
					<tr><td>	<a href="javascript:test(7)">Тест 7</a></td></tr>
					<tr><td>	<a href="javascript:test(8)">Тест 8</a></td></tr>
				</table>
			</td>
			<td bgcolor="#d0e7f7" valign="top" align="center" >&hairsp;</td>
			<td  width="750px" align="left" style = "border: #84bde4 1px solid;  background-color: #d0e7f7">
				<table id="descTable"></table>
			</td>

                </tr>

  </table> <!-- End of Func area -->



  </td></tr>
  </table>
    </td>
        </tr>   
</table> <!-- End of Main Table -->

<!-- Bottom Copyright Table --> 
<table cellspacing="0" cellpadding="0" width="1000"  align="center" border="0">
  <tr>
    <td height="3" bgcolor="#ff8a00"></td>
  </tr>
        <tr>
          <td class="title_blue" >
            &copy; Урмас Репинский, urrimus@hotmail.com
          </td>
        </tr>
</table>
<!-- End of Bottom Copyright Table --> 



<script>

function formatBytes(bytes) {
	var units = ['B', 'KB', 'MB', 'GB', 'TB'];
	var bytes_i = parseInt(bytes);
	var i;
	for (i = 0; bytes_i >= 1000 && i < 4; i++) {
		bytes_i /= 1000;
	}
	if (i==0) return bytes_i +" "+ units[i];
 	return bytes_i.toFixed(2) +" "+ units[i];
}

function algoritm() {
	table=document.getElementById("descTable");
	while(table.childNodes.length>0){table.removeChild(table.lastChild);}

	var tableRow = table.insertRow(-1);
	var cell1=tableRow.insertCell(0);
	cell1.innerHTML='<b>Тестовое Задание:</b>';

	var tableRow = table.insertRow(-1);
	var cell1=tableRow.insertCell(0);
	cell1.innerHTML='<P>Есть множество (массив, где порядок не важен) целых чисел в диапазоне от 1 до 300. Количество чисел - до 1000. Напишите функцию сериализации / десериализации в строку, чтобы итоговая строка была компактной.';

	var tableRow = table.insertRow(-1);
	var cell1=tableRow.insertCell(0);
	cell1.innerHTML='<b>Решение:</b>';

	var tableRow = table.insertRow(-1);
	var cell1=tableRow.insertCell(0);
	cell1.innerHTML='<P>Проблема в том что при обычной сериализации (с использованием JSON.stringify(obj)) каждое число 1...300 кодируется 1-3 знаками плюс запятая (каждый знак - 1 B), что занимает 4*Кол-во чисел Байт.';

	var tableRow = table.insertRow(-1);
	var cell1=tableRow.insertCell(0);
	cell1.innerHTML='<P>Для сериализации чисел 1...255 можно сохранять 1 символ для каждого числа, который соответствовал бы ASCII коду, которому соответствует данное число. Запятая в таком случае не нужна, так как каждое число кодируется 1 символом.';

	var tableRow = table.insertRow(-1);
	var cell1=tableRow.insertCell(0);
	cell1.innerHTML='<P>Для сериализации чисел 256...300 можно сохранять 2 символа для каждого числа, где первый указывает на то что число больше 255, второй определяет разницу Число-255. Первый символ может быть символом, который соответствует ASCII коду 0. Запятая в таком случае тоже не нужна, так как можно по первому символу определить число 2 байта или 1.';

	var tableRow = table.insertRow(-1);
	var cell1=tableRow.insertCell(0);
	cell1.innerHTML='<P>Для сохранения 1 ASCII символа используется 1 Байт, что занимает Кол-во Чисел Байт, если число <256, или 2 Байта, если число >=256, что занимает 2*Кол-во Чисел Байт, что в примерно в 3 раза меньше чем для обычной сериализации. Соответственные тесты показывают это.';

}

function generateTestArray(id) {
	arr=[];
	if (id==1) {
		for (let i = 0; i < 50; i++) {
			arr[i]=Math.floor(Math.random() * 300) + 1;
		}
	}
	if (id==2) {
		for (let i = 0; i < 100; i++) {
			arr[i]=Math.floor(Math.random() * 300) + 1;
		}
	}
	if (id==3) {
		for (let i = 0; i < 500; i++) {
			arr[i]=Math.floor(Math.random() * 300) + 1;
		}
	}
	if (id==4) {
		for (let i = 0; i < 1000; i++) {
			arr[i]=Math.floor(Math.random() * 300) + 1;
		}
	}
	if (id==5) {
		for (let i = 0; i < 900; i++) {
			arr[i]=Math.floor(Math.random() * 9) + 1;
		}
	}
	if (id==6) {
		for (let i = 0; i < 900; i++) {
			arr[i]=Math.floor(Math.random() * 89) + 10;
		}
	}
	if (id==7) {
		for (let i = 0; i < 900; i++) {
			arr[i]=Math.floor(Math.random() * 200) + 100;
		}
	}
	if (id==8) {
		c=0;
		for (let i = 0; i < 900; i++) {
			if (c==0) arr[i]=Math.floor(Math.random() * 9) + 1;
			if (c==1) arr[i]=Math.floor(Math.random() * 89) + 10;
			if (c==2) arr[i]=Math.floor(Math.random() * 200) + 100;
			c++;
			if (c==3) c=0;
		}
	}
	return arr;
 }

function serializeTestArray(arr) {

	serArr="";
	for (let i = 0; i < arr.length; i++) {
		if (arr[i]<256) serStr=String.fromCharCode(arr[i]);
		if (arr[i]>=256) serStr=String.fromCharCode(0)+String.fromCharCode(arr[i]-255);
		serArr=serArr+serStr;
	}
	return serArr;
 }

function deserializeString(serArr) {

	arr=[];
	c=0;
	for (let i = 0; i < serArr.length; i++) {
		arr[c]=serArr.charCodeAt(i);
		if (arr[c]==0) {
			arr[c]=serArr.charCodeAt(i+1)+255;
			i++;
		}
		c++;
	}
	return arr;
 }



function test(id) {
	table=document.getElementById("descTable");
	while(table.childNodes.length>0){table.removeChild(table.lastChild);}

	var tableRow = table.insertRow(-1);
	var cell1=tableRow.insertCell(0);
	cell1.innerHTML='<b>Тест '+id+":</b> <a href='javascript:test("+id+")'>Снова</a>";

	var tableRow = table.insertRow(-1);
	var cell1=tableRow.insertCell(0);
	if (id==1) {
		cell1.innerHTML='<P>Случайные - 50 Чисел.';
	}
	if (id==2) {
		cell1.innerHTML='<P>Случайные - 100 Чисел.';
	}
	if (id==3) {
		cell1.innerHTML='<P>Случайные - 500 Чисел.';
	}
	if (id==4) {
		cell1.innerHTML='<P>Случайные - 1000 Чисел.';
	}
	if (id==5) {
		cell1.innerHTML='<P>Все числа 1 знака. Всего чисел 900.';
	}
	if (id==6) {
		cell1.innerHTML='<P>Все числа из 2х знаков. Всего чисел 900.';
	}
	if (id==7) {
		cell1.innerHTML='<P>Все числа из 3х знаков. Всего чисел 900.';
	}
	if (id==8) {
		cell1.innerHTML='<P>Каждого числа по 3 (1 знака, из 2х знаков, из 3х знаков). Всего чисел 900.';
	}

	var tableRow = table.insertRow(-1);
	var cell1=tableRow.insertCell(0);
	cell1.innerHTML='<P>Обычная сериализация с использованием JSON.stringify(obj):';

	arr=generateTestArray(id);
	arrJSON=JSON.stringify(arr);
	var tableRow = table.insertRow(-1);
	var cell1=tableRow.insertCell(0);
	cell1.innerHTML="<div style='width: 750px; overflow:auto;'>"+arrJSON+"</div>";

	var tableRow = table.insertRow(-1);
	var cell1=tableRow.insertCell(0);
	cell1.innerHTML='<P>Занимает <b>'+formatBytes(arrJSON.length)+"</b>";

	var tableRow = table.insertRow(-1);
	var cell1=tableRow.insertCell(0);
	cell1.innerHTML='<P>Сериализация с использованием ASCII кодов:';

	serArr=serializeTestArray(arr);
	var tableRow = table.insertRow(-1);
	var cell1=tableRow.insertCell(0);
	cell1.innerHTML="<div style='width: 750px; overflow:auto;'>"+serArr+"</div>";

	var tableRow = table.insertRow(-1);
	var cell1=tableRow.insertCell(0);
	cell1.innerHTML='<P>Занимает <b>'+formatBytes(serArr.length)+"</b>";

	var tableRow = table.insertRow(-1);
	var cell1=tableRow.insertCell(0);
	cell1.innerHTML='<P>Десериализация с использованием ASCII кодов:';

	arr2=deserializeString(serArr);
	arr2JSON=JSON.stringify(arr2);
	var tableRow = table.insertRow(-1);
	var cell1=tableRow.insertCell(0);
	cell1.innerHTML="<div style='width: 750px; overflow:auto;'>"+arr2JSON+"</div>";

	textYesNo="";
	if (arrJSON==arr2JSON) {
		textYesNo="Да";
	} else {
		textYesNo="Нет";
	}
	var tableRow = table.insertRow(-1);
	var cell1=tableRow.insertCell(0);
	cell1.innerHTML="<P>Исходный Массив идентичен массиву после сериализации/десериализации? : <b>"+textYesNo+"</b>";

	compression=((serArr.length/arrJSON.length)*100).toFixed(2);
	var tableRow = table.insertRow(-1);
	var cell1=tableRow.insertCell(0);
	cell1.innerHTML="<P>Сжатие : <b>"+compression+" %</b>";	
 }




</script>


</body>
</html>



